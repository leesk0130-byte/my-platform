<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0f172a">
  <title>글쓰기 | 가맹점숲</title>
  <meta name="description" content="가맹점숲 커뮤니티에 글을 남겨 보세요. 수수료·정산·운영 정보를 나누거나 질문할 수 있습니다.">
  <meta name="robots" content="noindex, nofollow">
  <link rel="canonical" href="https://my-platform.pages.dev/write.html">
  <link rel="stylesheet" href="css/common.css">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3006893636342653" crossorigin="anonymous"></script>
</head>
<body>
  <a href="#main" class="skip-link">본문으로 건너뛰기</a>
  <header>
    <h1><a href="index.html">가맹점숲</a></h1>
    <button type="button" class="nav-toggle" aria-label="메뉴 열기" aria-expanded="false" data-toggle-nav><span></span><span></span><span></span></button>
    <nav class="header-nav" id="headerNav" aria-label="메인 메뉴">
      <a href="community.html" class="active">커뮤니티</a>
      <a href="pg.html">PG 수수료</a>
      <a href="calculator.html">수수료 비교 계산기</a>
      <a href="news.html">최신 공지/뉴스</a>
      <a href="verify.html">인증/제휴 문의</a>
    </nav>
    <div class="header-auth" id="headerAuth">
      <div id="auth-actions"></div>
      <a href="community.html" class="btn btn-outline">목록으로</a>
    </div>
  </header>

  <main id="main" class="container page-community">
    <nav class="breadcrumb" aria-label="breadcrumb"><a href="index.html">홈</a> <span class="bc-sep">/</span> <a href="community.html">커뮤니티</a> <span class="bc-sep">/</span> <strong>글쓰기</strong></nav>
    <div class="hero">
      <h2>글쓰기</h2>
      <p>온라인 가맹점 커뮤니티에 글을 남겨 보세요. 수수료·정산·운영 정보를 나누거나 질문해 주세요.</p>
      <p class="hero-hint">로그인 없이도 쓸 수 있어요. 아래에서 닉네임만 입력하면 글에 표시됩니다. 비우면 익명으로 올라갑니다.</p>
    </div>
    <section class="section">
      <div class="card card-content">
        <div class="community-rules-notice" role="alert" style="background:#fef3c7;border:1px solid #f59e0b;border-radius:12px;padding:1rem 1.25rem;margin-bottom:1.25rem;font-size:0.9375rem;">
          <strong>금지행위 안내</strong> — 상업적 광고·도배·개인정보(사업자번호, 계좌번호 등) 노출은 금지됩니다. 위반 시 글이 블라인드·삭제될 수 있으며, 반복 시 이용이 제한됩니다.
        </div>
        <div class="form-group" style="margin-bottom:1rem;">
          <span class="form-label" style="display:block;margin-bottom:0.5rem;">질문 템플릿 (클릭 시 제목·내용 자동 채움)</span>
          <div class="template-buttons" style="display:flex;flex-wrap:wrap;gap:0.5rem;">
            <button type="button" class="btn btn-outline btn-sm" data-template="settlement-delay">정산 지연</button>
            <button type="button" class="btn btn-outline btn-sm" data-template="refund">환불</button>
            <button type="button" class="btn btn-outline btn-sm" data-template="virtual-account">가상계좌</button>
            <button type="button" class="btn btn-outline btn-sm" data-template="review">심사</button>
          </div>
        </div>
        <form id="writeForm" class="write-form" onsubmit="return false;">
          <div class="form-group">
            <label for="write-nickname">닉네임 (글에 표시될 이름)</label>
            <input type="text" id="write-nickname" placeholder="비워두면 익명으로 표시돼요" maxlength="20" aria-describedby="write-nickname-help">
            <span id="write-nickname-help" class="form-hint">입력하지 않으면 익명으로 표시됩니다.</span>
          </div>
          <div class="form-group">
            <label for="write-industry">업종 <span style="color:#dc2626;">*</span></label>
            <select id="write-industry" required>
              <option value="">선택하세요</option>
              <option value="의류/패션">의류/패션</option>
              <option value="뷰티/화장품">뷰티/화장품</option>
              <option value="식품">식품</option>
              <option value="가전/디지털">가전/디지털</option>
              <option value="생활/건강">생활/건강</option>
              <option value="기타 소매">기타 소매</option>
              <option value="서비스/교육">서비스/교육</option>
              <option value="기타">기타</option>
            </select>
          </div>
          <div class="form-group">
            <label for="write-monthly-volume">월 거래액 구간 <span style="color:#dc2626;">*</span></label>
            <select id="write-monthly-volume" required>
              <option value="">선택하세요</option>
              <option value="~500만원">~500만원</option>
              <option value="500만~1천만원">500만~1천만원</option>
              <option value="1천만~3천만원">1천만~3천만원</option>
              <option value="3천만~1억원">3천만~1억원</option>
              <option value="1억원~">1억원~</option>
            </select>
          </div>
          <div class="form-group">
            <label for="write-pg-used">사용 PG <span style="color:#dc2626;">*</span></label>
            <select id="write-pg-used" required>
              <option value="">선택하세요</option>
              <option value="토스페이먼츠">토스페이먼츠</option>
              <option value="이니시스">이니시스</option>
              <option value="나이스페이먼츠">나이스페이먼츠</option>
              <option value="KG이니시스">KG이니시스</option>
              <option value="다우페이">다우페이</option>
              <option value="KCP">KCP</option>
              <option value="결제예정">결제예정</option>
              <option value="기타">기타</option>
            </select>
          </div>
          <div class="form-group">
            <label for="write-board">게시판</label>
            <select id="write-board">
              <option value="free">자유게시판</option>
              <option value="fee">수수료/정산</option>
              <option value="qna">질문답변</option>
              <option value="info">정보공유</option>
            </select>
          </div>
          <div class="form-group" id="write-notice-wrap">
            <input type="checkbox" id="write-notice" value="1"> <label for="write-notice">공지로 등록</label>
            <span id="write-notice-hint" class="form-hint">로그인한 운영자만 체크할 수 있어요. 목록 상단에 고정돼요.</span>
          </div>
          <div class="form-group">
            <label for="write-title">제목</label>
            <input type="text" id="write-title" placeholder="제목을 입력하세요" required maxlength="200">
          </div>
          <div class="form-group">
            <label for="write-body">내용</label>
            <textarea id="write-body" placeholder="내용을 입력하세요" required></textarea>
          </div>
          <div id="write-error" class="msg-error" style="display:none;"></div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">등록하기</button>
            <a href="community.html" class="btn btn-outline">취소</a>
          </div>
        </form>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-inner">
      <p><a href="about.html">가맹점숲이란?</a> | <a href="must-know.html">꼭 알아야 할 것</a> | <a href="terms.html">이용약관</a> | <a href="privacy.html">개인정보처리방침</a> | <a href="verify.html">인증/제휴 문의</a></p>
      <p>© 2025–2026 가맹점숲. 온라인 가맹점 정보 & 커뮤니티. All rights reserved.</p>
      <div class="footer-contact">
        <h4>문의</h4>
        <p>이메일: <a href="mailto:leesk0130@naver.com?subject=가맹점숲 문의">leesk0130@naver.com</a></p>
        <p class="footer-hours">운영 시간: 평일 09:00–18:00 (답변은 1–2 영업일 내)</p>
      </div>
    </div>
  </footer>

  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="js/config.js"></script>
  <script src="js/app.js"></script>
  <script src="js/auth.js"></script>
  <script>
    // 공지 체크: 항상 표시, 운영자만 체크 가능
    (function() {
      function showNoticeCheck() {
        var wrap = document.getElementById('write-notice-wrap');
        var cb = document.getElementById('write-notice');
        var hint = document.getElementById('write-notice-hint');
        if (!wrap || !cb) return;
        var isOp = window.app && window.app.isOperator && window.app.isOperator();
        wrap.style.display = 'block';
        cb.disabled = !isOp;
        if (hint) hint.textContent = isOp ? '목록 상단에 고정돼요. (운영자)' : '로그인한 운영자만 체크할 수 있어요. 목록 상단에 고정돼요.';
      }
      if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', showNoticeCheck); else showNoticeCheck();
      window.addEventListener('authStateChanged', showNoticeCheck);
    })();
    // 글쓰기 페이지 전용 스크립트
    (function() {
      var params = new URLSearchParams(location.search);
      var board = params.get('board');
      if (board) {
        var sel = document.getElementById('write-board');
        if (sel) sel.value = board;
      }
      var user = window.app && window.app.getUser && window.app.getUser();
      var nicknameInput = document.getElementById('write-nickname');
      if (user && user.name && nicknameInput && !nicknameInput.value.trim()) {
        nicknameInput.placeholder = user.name + ' (로그인됨)';
        nicknameInput.value = user.name;
      }
      var templates = {
        'settlement-delay': { title: '[정산 지연] 정산이 늦어요. 확인할 것 알려주세요', body: '정산 예정일이 지났는데 입금이 안 됐어요.\n\n- 사용 PG:\n- 정산 예정일:\n- 해당 기간 매출 요약:\n\n어디부터 확인하면 좋을까요?' },
        'refund': { title: '[환불] 취소/환불 처리 문의드려요', body: '고객 취소·환불 건 처리 방법이 궁금해요.\n\n- 사용 PG:\n- 전액 취소 / 부분 환불:\n- 문의 내용:\n\n절차나 수수료 정책 알려주시면 감사해요.' },
        'virtual-account': { title: '[가상계좌] 입금 기한·미확인 문의', body: '가상계좌(무통장) 결제 관련해서요.\n\n- 사용 PG:\n- 입금했는데 미확인으로 나와요 / 입금 기한 연장 가능한지:\n\n경험 있으신 분 조언 부탁드려요.' },
        'review': { title: '[심사] PG 가맹점 심사 기간·서류 문의', body: 'PG 가맹점 신청했는데 심사 관련해서요.\n\n- 신청한 PG:\n- 업종:\n- 심사 기간이 궁금해요 / 거절됐는데 재신청 가능한지:\n\n알려주시면 감사해요.' }
      };
      document.querySelectorAll('.write-template-btns button[data-template], .template-buttons button[data-template]').forEach(function(btn) {
        btn.addEventListener('click', function() {
          var t = templates[this.getAttribute('data-template')];
          if (t) {
            var titleEl = document.getElementById('write-title');
            var bodyEl = document.getElementById('write-body');
            if (titleEl) titleEl.value = t.title;
            if (bodyEl) bodyEl.value = t.body;
          }
        });
      });
      var form = document.getElementById('writeForm');
      var errEl = document.getElementById('write-error');
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        var nickname = document.getElementById('write-nickname').value.trim();
        if (!nickname) nickname = '익명';
        var title = document.getElementById('write-title').value.trim();
        var body = document.getElementById('write-body').value.trim();
        var boardVal = document.getElementById('write-board').value;
        var industry = (document.getElementById('write-industry') || {}).value || '';
        var monthlyVolume = (document.getElementById('write-monthly-volume') || {}).value || '';
        var pgUsed = (document.getElementById('write-pg-used') || {}).value || '';
        if (!title || !body) {
          errEl.textContent = '제목과 내용을 입력해 주세요.';
          errEl.style.display = 'block';
          return;
        }
        if (!industry || !monthlyVolume || !pgUsed) {
          errEl.textContent = '업종, 월 거래액 구간, 사용 PG를 선택해 주세요.';
          errEl.style.display = 'block';
          return;
        }
        errEl.style.display = 'none';
        var submitBtn = form.querySelector('button[type="submit"]');
        if (submitBtn) { submitBtn.disabled = true; submitBtn.textContent = '등록 중...'; }
        var isNotice = document.getElementById('write-notice') && document.getElementById('write-notice').checked;
        window.app.createPost({ title: title, body: body, author: nickname || '익명', board: boardVal, notice: isNotice, industry: industry, monthlyVolume: monthlyVolume, pgUsed: pgUsed }, function(err, post) {
          if (submitBtn) { submitBtn.disabled = false; submitBtn.textContent = '등록하기'; }
          if (err) {
            errEl.textContent = err;
            errEl.style.display = 'block';
            return;
          }
          if (post && post.id) location.href = 'community.html?id=' + encodeURIComponent(post.id);
        });
      });
    })();
    function toggleNav() {
      var nav = document.getElementById('headerNav');
      var btn = document.querySelector('.nav-toggle');
      if (!nav || !btn) return;
      var open = nav.classList.toggle('is-open');
      btn.setAttribute('aria-expanded', open);
      btn.setAttribute('aria-label', open ? '메뉴 닫기' : '메뉴 열기');
    }
  </script>
</body>
</html>
