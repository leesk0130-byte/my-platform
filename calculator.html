<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0f172a">
  <title>결제 수수료 계산기 | 가맹점숲 - PG 수수료 계산</title>
  <meta name="description" content="카드·현금 비율과 금액을 넣으면 PG 결제 수수료를 한 번에 계산. 온라인 쇼핑몰·가맹점 사장님 필수 결제 수수료 계산기.">
  <meta name="keywords" content="가맹점숲, 결제 수수료 계산기, PG 수수료, 수수료 계산기, 온라인 가맹점, PG, 온라인쇼핑몰">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://my-platform.pages.dev/calculator.html">
  <meta property="og:type" content="website">
  <meta property="og:title" content="결제수수료 계산기 | 가맹점숲">
  <meta property="og:description" content="카드·현금 비율과 금액을 넣으면 PG 결제수수료를 한 번에 계산. 사장님 필수.">
  <meta property="og:url" content="https://my-platform.pages.dev/calculator.html">
  <meta property="og:locale" content="ko_KR">
  <meta property="og:image" content="https://my-platform.pages.dev/og-image.svg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="결제수수료 계산기 | 가맹점숲">
  <meta name="twitter:description" content="카드·현금 비율과 금액을 넣으면 PG 결제수수료를 한 번에 계산. 사장님 필수.">
  <meta name="twitter:image" content="https://my-platform.pages.dev/og-image.svg">
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"SoftwareApplication","name":"결제 수수료 계산기 | 가맹점숲","applicationCategory":"FinanceApplication","description":"카드·현금 비율과 금액을 넣으면 PG 결제 수수료를 한 번에 계산. 온라인 가맹점·쇼핑몰 사장님 필수 도구.","url":"https://my-platform.pages.dev/calculator.html","operatingSystem":"Any","offers":{"@type":"Offer","price":"0","priceCurrency":"KRW"},"author":{"@type":"Organization","name":"가맹점숲","url":"https://my-platform.pages.dev/"}}
  </script>
  <link rel="stylesheet" href="css/common.css">
  <style>
    /* common.css 로드 실패 시 계산기 페이지만이라도 보이도록 필수 스타일 */
    body { font-family: 'Pretendard', -apple-system, sans-serif; line-height: 1.65; color: #0f172a; background: #f8fafc; margin: 0; }
    a { color: #0d9488; text-decoration: none; }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem 2rem; }
    header { background: #0f172a; color: #fff; padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
    header h1 { font-size: 1.25rem; margin: 0; }
    header h1 a { color: #fff; }
    .header-nav { display: flex; gap: 2rem; }
    .header-nav a { color: #94a3b8; font-weight: 500; }
    .header-nav a:hover, .header-nav a.active { color: #fff; }
    .header-auth { display: flex; gap: 0.5rem; }
    .btn { display: inline-block; padding: 0.5rem 1rem; border-radius: 12px; font-size: 0.9rem; font-weight: 600; cursor: pointer; border: none; }
    .btn-outline { background: transparent; color: #94a3b8; border: 1px solid #475569; }
    .btn-outline:hover { background: #334155; color: #fff; }
    .btn-primary { background: linear-gradient(135deg, #0d9488, #0f766e); color: #fff; }
    .btn-primary:hover { opacity: 0.95; }
    .breadcrumb { font-size: 0.875rem; color: #64748b; margin-bottom: 0.75rem; }
    .breadcrumb a { color: #64748b; }
    .bc-sep { margin: 0 0.25rem; color: #94a3b8; }
    /* ── 히어로: common.css에서 padding/크기 통일, 여기서는 색·타이포만 ── */
    .hero {
      color: #fff;
      text-align: left;
      margin-bottom: 2rem;
    }
    .hero h2 { font-size: 1.6rem; margin: 0 0 0.65rem; line-height: 1.3; }
    @media (min-width: 600px) { .hero h2 { font-size: 1.75rem; } }
    .hero p {
      opacity: 0.95;
      font-size: 1rem;
      line-height: 1.65;
      margin: 0 0 0.75rem;
      max-width: 66ch;
    }
    .hero p:last-child { margin-bottom: 0; }
    @media (min-width: 600px) { .hero p { font-size: 1.05rem; } }
    .card { background: #fff; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); overflow: hidden; }
    .card-content { padding: 1.5rem 2rem; }
    .section { margin-bottom: 2rem; }
    .section-title { font-size: 1.1rem; font-weight: 700; padding: 1rem 1.25rem; border-bottom: 1px solid #f1f5f9; margin: 0; }
    .form-group { margin-bottom: 1rem; }
    .form-group label { display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.35rem; color: #475569; }
    .form-group input, .form-group select { width: 100%; padding: 0.6rem 0.85rem; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 1rem; box-sizing: border-box; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    @media (max-width: 600px) { .form-row { grid-template-columns: 1fr; } }
    .calc-mode-tabs { display: flex; margin-bottom: 1.25rem; }
    .calc-mode-btn { padding: 0.75rem 1.25rem; border: 1px solid #e2e8f0; background: #f8fafc; font-size: 0.875rem; font-weight: 600; cursor: pointer; border-radius: 0; }
    .calc-mode-btn:first-child { border-radius: 12px 0 0 12px; }
    .calc-mode-btn:last-child { border-radius: 0 12px 12px 0; border-left: none; }
    .calc-mode-btn.active { background: #0d9488; color: #fff; border-color: #0d9488; }
    .calc-type-btn { padding: 0.5rem 1rem; border: 1px solid #e2e8f0; background: #f8fafc; font-size: 0.875rem; font-weight: 600; cursor: pointer; border-radius: 8px; margin-right: 0.5rem; }
    .calc-type-btn.active { background: #0d9488; color: #fff; border-color: #0d9488; }
    .calc-desc { font-size: 0.875rem; color: #64748b; margin-bottom: 1rem; }
    .calc-panel { margin-bottom: 1.5rem; }
    .calc-fee-rates { margin-bottom: 1.5rem; padding-top: 1rem; border-top: 1px solid #f1f5f9; }
    .calc-actions { margin-bottom: 1.5rem; }
    .calc-result { padding: 1.5rem; background: #f0fdfa; border: 1px solid #99f6e4; border-radius: 12px; }
    .calc-result-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 1rem; color: #0f766e; }
    .calc-result-list { display: grid; grid-template-columns: auto 1fr; gap: 0.5rem 1.5rem; align-items: baseline; }
    .calc-result-list dt { font-weight: 600; color: #475569; }
    .calc-result-list dd { margin: 0; font-weight: 600; color: #0f172a; }
    .calc-result-list dt.calc-result-total, .calc-result-list dd.calc-result-total { font-size: 1.1rem; margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #99f6e4; color: #0f766e; }
    .calc-result-list dd .calc-result-kr { display: block; font-size: 0.875rem; font-weight: 500; color: #64748b; margin-top: 0.25rem; }
    /* ── 프리셋 ── */
    .calc-presets { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1.25rem; }
    .calc-preset-btn { padding: 0.4rem 0.85rem; border: 1px solid #cbd5e1; background: #f8fafc; color: #475569; font-size: 0.8125rem; font-weight: 600; border-radius: 999px; cursor: pointer; transition: background 0.15s, color 0.15s; white-space: nowrap; }
    .calc-preset-btn:hover { background: #e2e8f0; color: #0f172a; }
    /* ── 인라인 에러 ── */
    .field-error { display: none; font-size: 0.8125rem; color: #dc2626; margin-top: 0.3rem; }
    .field-error.is-visible { display: block; }
    /* ── 입력창 에러 상태 ── */
    .input-with-kr.is-error { border-color: #fca5a5; }
    .form-group input.is-error { border-color: #fca5a5; }
    /* ── 결과 조건 요약 ── */
    .calc-result-summary { font-size: 0.8125rem; color: #0f766e; background: #ccfbf1; border-radius: 8px; padding: 0.6rem 0.9rem; margin-bottom: 1rem; line-height: 1.6; }
    /* ── 수수료율 강조 ── */
    .calc-result-rate { font-size: 0.875rem; color: #64748b; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px dashed #99f6e4; }
    /* ── 계산 버튼 비활성 ── */
    #calc-do:disabled { opacity: 0.45; cursor: not-allowed; }
    footer { background: #0f172a; color: #94a3b8; padding: 2rem 1.5rem; margin-top: 2.5rem; font-size: 0.875rem; }
    .footer-inner { max-width: 1200px; margin: 0 auto; text-align: center; }
    .footer-inner a { color: #cbd5e1; }
    .footer-contact { margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #334155; }
    .footer-contact h4 { font-size: 0.875rem; font-weight: 700; color: #fff; margin-bottom: 1rem; }
    .footer-contact p { margin: 0.25rem 0; font-size: 0.875rem; }
    /* 입력창 안에 숫자 오른쪽에 한글 금액 (같은 창으로 보이게) */
    .input-with-kr {
      display: flex;
      align-items: center;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      background: #fff;
      padding: 0 1rem;
      min-height: 2.75rem;
      box-sizing: border-box;
    }
    .input-with-kr input {
      flex: 1;
      min-width: 0;
      border: none;
      background: none;
      padding: 0.65rem 0;
      font-size: 1rem;
    }
    .input-with-kr input:focus { outline: none; }
    .calc-input-kr {
      font-size: 0.875rem;
      color: #64748b;
      opacity: 0.7;
      white-space: nowrap;
      margin-left: 0.5rem;
    }
    /* ── 모바일 계산기 최적화 ── */
    @media (max-width: 768px) {
      .form-row { grid-template-columns: 1fr !important; }
      .calc-mode-tabs { gap: 0; }
      .calc-mode-btn { flex: 1; min-height: 44px; font-size: 0.875rem; padding: 10px 8px; }
      .calc-type-btn { min-height: 44px; padding: 10px 14px; font-size: 0.875rem; }
      .calc-preset-btn { min-height: 40px; font-size: 0.8125rem; }
      .calc-actions {
        display: flex !important;
        flex-direction: column;
        gap: 8px;
      }
      .calc-actions .btn { width: 100% !important; min-height: 44px; }
      #calc-do { min-height: 48px !important; font-size: 1rem !important; width: 100% !important; }
      .input-with-kr { min-height: 44px; }
      .card-content { padding: 16px !important; }
    }
  </style>
  <script src="js/analytics-stub.js"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3006893636342653" crossorigin="anonymous"></script>
</head>
<body>
  <a href="#main" class="skip-link">본문으로 건너뛰기</a>
  <header>
    <h1><a href="index.html">가맹점숲</a></h1>
    <button type="button" class="nav-toggle" aria-label="메뉴 열기" aria-expanded="false" data-toggle-nav><span></span><span></span><span></span></button>
    <nav class="header-nav" id="headerNav" aria-label="메인 메뉴">
      <a href="community.html">커뮤니티</a>
      <a href="pg.html">PG 수수료</a>
      <a href="calculator.html" class="active">수수료 비교 계산기</a>
      <a href="news.html">최신 공지/뉴스</a>
      <a href="verify.html">인증/제휴 문의</a>
    </nav>
    <form class="header-search" action="community.html" method="get" role="search" aria-label="사이트 검색">
      <label for="header-search-q" class="sr-only">뉴스·가이드·커뮤니티 검색</label>
      <input type="search" id="header-search-q" name="q" placeholder="검색어 입력" autocomplete="off" aria-label="검색어">
      <button type="submit" class="btn btn-outline btn-sm">검색</button>
    </form>
    <div class="header-auth" id="headerAuth" aria-label="로그인 상태">
      <div id="auth-actions"></div>
    </div>
  </header>

  <main id="main" class="container page-calculator">
    <nav class="breadcrumb" aria-label="breadcrumb"><a href="index.html">홈</a> <span class="bc-sep">/</span> <strong>결제수수료 계산기</strong></nav>
    <div class="hero hero-banner" style="min-height:240px;padding:40px 60px;display:flex;flex-direction:column;justify-content:center;align-items:flex-start;border-radius:20px;box-sizing:border-box;">
      <h2>결제수수료 계산기</h2>
      <p>총 거래액과 <strong>카드/현금 비율</strong> 또는 <strong>카드·현금 금액</strong>을 넣으면 PG 수수료를 바로 계산해 드려요.</p>
      <p>월 매출에서 카드·현금 비율과 수수료율만 입력하면 예상 수수료가 나옵니다. PG사 비교할 때 참고하세요.</p>
    </div>

    <section class="section">
      <div class="card card-content">
        <p class="calc-desc" style="margin-bottom:0.75rem;"><a href="calculator-saved.html">저장한 계산 목록</a></p>

        <!-- 입력 모드 탭 -->
        <div class="calc-mode-tabs" role="tablist" aria-label="입력 방식" style="margin-bottom:0.5rem;">
          <button type="button" class="calc-mode-btn active" data-mode="ratio"
            role="tab" aria-selected="true" aria-controls="calc-ratio" id="tab-ratio">비율로 입력</button>
          <button type="button" class="calc-mode-btn" data-mode="amount"
            role="tab" aria-selected="false" aria-controls="calc-amount" id="tab-amount">금액으로 입력</button>
        </div>
        <!-- 계산 유형 탭 -->
        <div class="calc-mode-tabs" style="margin-bottom:1.25rem;">
          <button type="button" class="calc-type-btn active" data-type="single">단일 계산</button>
          <button type="button" class="calc-type-btn" data-type="compare">A vs B 비교</button>
        </div>

        <!-- 프리셋 버튼 -->
        <div class="calc-presets" aria-label="빠른 입력 프리셋">
          <button type="button" class="calc-preset-btn" data-preset="general">일반 쇼핑몰 (카드 70 / 현금 30)</button>
          <button type="button" class="calc-preset-btn" data-preset="cash-heavy">현금 비중 높은 업종 (카드 40 / 현금 60)</button>
          <button type="button" class="calc-preset-btn" data-preset="card-only">카드 위주 (카드 90 / 현금 10)</button>
        </div>

        <!-- 비율 입력 패널 -->
        <div id="calc-ratio" class="calc-panel" role="tabpanel" aria-labelledby="tab-ratio">
          <p class="calc-desc">총 거래액과 카드·현금 비율(%)을 입력하세요. 합이 100%여야 합니다.</p>
          <div class="form-group">
            <label for="total-amount">총 거래액 (원)</label>
            <div class="input-with-kr" id="total-amount-wrap">
              <input type="text" id="total-amount" inputmode="numeric" placeholder="예: 10,000,000" autocomplete="off" aria-describedby="total-amount-err">
              <span class="calc-input-kr" id="total-amount-kr" aria-hidden="true"></span>
            </div>
            <p class="field-error" id="total-amount-err" role="alert"></p>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="card-ratio">카드 비율 (%)</label>
              <input type="number" id="card-ratio" placeholder="예: 70" min="0" max="100" step="0.1" value="70" aria-describedby="ratio-sum-err">
            </div>
            <div class="form-group">
              <label for="cash-ratio">현금·실시간이체 비율 (%)</label>
              <input type="number" id="cash-ratio" placeholder="예: 30" min="0" max="100" step="0.1" value="30" aria-describedby="ratio-sum-err">
            </div>
          </div>
          <p class="field-error" id="ratio-sum-err" role="alert"></p>
        </div>

        <!-- 금액 직접 입력 패널 -->
        <div id="calc-amount" class="calc-panel" role="tabpanel" aria-labelledby="tab-amount" style="display:none;">
          <p class="calc-desc">카드 거래액과 현금(실시간이체 등) 거래액을 직접 입력하세요.</p>
          <div class="form-row">
            <div class="form-group">
              <label for="card-amount">카드 거래액 (원)</label>
              <div class="input-with-kr" id="card-amount-wrap">
                <input type="text" id="card-amount" inputmode="numeric" placeholder="예: 7,000,000" autocomplete="off" aria-describedby="amount-sum-err">
                <span class="calc-input-kr" id="card-amount-kr" aria-hidden="true"></span>
              </div>
            </div>
            <div class="form-group">
              <label for="cash-amount">현금·실시간이체 거래액 (원)</label>
              <div class="input-with-kr" id="cash-amount-wrap">
                <input type="text" id="cash-amount" inputmode="numeric" placeholder="예: 3,000,000" autocomplete="off" aria-describedby="amount-sum-err">
                <span class="calc-input-kr" id="cash-amount-kr" aria-hidden="true"></span>
              </div>
            </div>
          </div>
          <p class="field-error" id="amount-sum-err" role="alert"></p>
        </div>

        <!-- 단일 수수료율 -->
        <div id="calc-fee-single" class="calc-fee-rates">
          <p class="calc-desc">본인 PG 계약 조건에 맞는 수수료율(%)을 입력하세요. <a href="pg.html">PG 수수료 참고</a></p>
          <div class="form-row">
            <div class="form-group">
              <label for="card-rate">카드 수수료율 (%)</label>
              <input type="number" id="card-rate" inputmode="decimal" placeholder="예: 3.2" min="0" max="100" step="0.01" value="3.2">
            </div>
            <div class="form-group">
              <label for="cash-rate">현금·실시간이체 수수료율 (%)</label>
              <input type="number" id="cash-rate" inputmode="decimal" placeholder="예: 2" min="0" max="100" step="0.01" value="2">
            </div>
          </div>
        </div>
        <!-- A vs B 수수료율 -->
        <div id="calc-fee-compare" class="calc-fee-rates" style="display:none;">
          <p class="calc-desc">PG A와 B의 수수료율을 각각 입력하세요. <a href="pg.html">PG 수수료 참고</a></p>
          <div class="form-row">
            <div class="form-group">
              <label for="card-rate-a">PG A 카드 수수료율 (%)</label>
              <input type="number" id="card-rate-a" inputmode="decimal" placeholder="예: 3.2" min="0" max="100" step="0.01" value="3.2">
            </div>
            <div class="form-group">
              <label for="cash-rate-a">PG A 현금 수수료율 (%)</label>
              <input type="number" id="cash-rate-a" inputmode="decimal" placeholder="예: 2" min="0" max="100" step="0.01" value="2">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="card-rate-b">PG B 카드 수수료율 (%)</label>
              <input type="number" id="card-rate-b" inputmode="decimal" placeholder="예: 2.8" min="0" max="100" step="0.01" value="2.8">
            </div>
            <div class="form-group">
              <label for="cash-rate-b">PG B 현금 수수료율 (%)</label>
              <input type="number" id="cash-rate-b" inputmode="decimal" placeholder="예: 1.5" min="0" max="100" step="0.01" value="1.5">
            </div>
          </div>
        </div>

        <!-- 액션 버튼 -->
        <div class="calc-actions">
          <button type="button" class="btn btn-primary" id="calc-do">수수료 계산하기</button>
          <button type="button" class="btn btn-outline" id="calc-save">저장</button>
          <button type="button" class="btn btn-outline" id="calc-share">링크 공유</button>
          <button type="button" class="btn btn-outline" id="calc-image-save">이미지로 저장</button>
        </div>

        <!-- 결과 카드 -->
        <div id="calc-result" class="calc-result" style="display:none;" aria-live="polite">
          <h4 class="calc-result-title">계산 결과</h4>
          <p class="calc-result-summary" id="calc-result-summary"></p>

          <dl class="calc-result-list" id="calc-result-single">
            <dt>총 거래액</dt>
            <dd id="result-total-amount">0원</dd>
            <dt>카드 거래액</dt>
            <dd id="result-card-amount">0원</dd>
            <dt>현금·실시간이체 거래액</dt>
            <dd id="result-cash-amount">0원</dd>
            <dt>카드 수수료</dt>
            <dd id="result-card-fee">0원</dd>
            <dt>현금 수수료</dt>
            <dd id="result-cash-fee">0원</dd>
            <dt class="calc-result-total">총 수수료</dt>
            <dd class="calc-result-total" id="result-total-fee">0원</dd>
            <dt>실 수령 예상</dt>
            <dd id="result-net">0원</dd>
          </dl>
          <p class="calc-result-rate" id="result-rate-pct" style="display:none;"></p>

          <dl class="calc-result-list" id="calc-result-compare" style="display:none;">
            <dt>총 거래액</dt>
            <dd id="result-comp-total">0원</dd>
            <dt>PG A 총 수수료</dt>
            <dd id="result-fee-a">0원</dd>
            <dt>PG B 총 수수료</dt>
            <dd id="result-fee-b">0원</dd>
            <dt class="calc-result-total">절감액 (A→B 전환 시)</dt>
            <dd class="calc-result-total" id="result-save-amount">0원</dd>
          </dl>
        </div>
      </div>
    </section>

    <section class="section" id="calc-related-section">
      <div class="card" style="background:var(--color-surface,#fff);border:1px solid #e2e8f0;">
        <h3 style="font-size:1rem;font-weight:700;margin-bottom:10px;">관련 가이드 · 커뮤니티</h3>
        <div style="display:flex;flex-wrap:wrap;gap:10px;">
          <a href="pg.html" class="btn btn-outline btn-sm">PG 수수료 비교표</a>
          <a href="must-know.html#pg-checklist" class="btn btn-outline btn-sm">PG 계약 체크리스트</a>
          <a href="must-know/settlement-delay.html" class="btn btn-outline btn-sm">정산 지연 가이드</a>
          <a href="must-know/refund.html" class="btn btn-outline btn-sm">환불 가이드</a>
          <a href="community.html?q=수수료" class="btn btn-outline btn-sm">수수료 커뮤니티</a>
          <a href="calculator-saved.html" class="btn btn-outline btn-sm">저장한 계산 목록</a>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-inner">
      <p><a href="about.html">가맹점숲이란?</a> | <a href="must-know.html">꼭 알아야 할 것</a> | <a href="terms.html">이용약관</a> | <a href="privacy.html">개인정보처리방침</a> | <a href="verify.html">인증/제휴 문의</a></p>
      <p>© 2025–2026 가맹점숲. All rights reserved.</p>
      <div class="footer-contact">
        <h4>문의</h4>
        <p>이메일: <a href="mailto:leesk0130@naver.com?subject=가맹점숲 문의">leesk0130@naver.com</a></p>
        <p class="footer-hours">운영 시간: 평일 09:00–18:00 (답변은 1–2 영업일 내)</p>
      </div>
    </div>
  </footer>

  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="js/config.js"></script>
  <script src="js/app.js"></script>
  <script src="js/auth.js"></script>
  <script>
  (function () {
    'use strict';
    if (window.trackEvent) window.trackEvent('pageview', { page: 'calculator' });

    var CALC_SAVED_KEY = 'gmp_calc_saved';
    var calcBtn = document.getElementById('calc-do');

    /* ── 유틸 ── */
    function toNum(val) {
      var n = parseFloat(String(val || '').replace(/,/g, ''));
      return isNaN(n) || n < 0 ? 0 : n;
    }
    function formatWithComma(val) {
      var digits = String(val || '').replace(/\D/g, '');
      if (!digits) return '';
      var n = parseInt(digits, 10);
      return isNaN(n) ? '' : n.toLocaleString('ko-KR');
    }
    function toKoreanAmount(n) {
      n = Math.floor(n);
      if (n >= 1e8) {
        var eok = Math.floor(n / 1e8), man = Math.floor((n % 1e8) / 1e4), rest = n % 1e4;
        return eok + '억' + (man > 0 ? ' ' + man.toLocaleString('ko-KR') + '만' : '') + (rest > 0 ? ' ' + rest.toLocaleString('ko-KR') : '') + '원';
      }
      if (n >= 1e4) {
        var man = Math.floor(n / 1e4), rest = n % 1e4;
        return man.toLocaleString('ko-KR') + '만' + (rest > 0 ? ' ' + rest.toLocaleString('ko-KR') : '') + '원';
      }
      return n.toLocaleString('ko-KR') + '원';
    }
    function fmt(n) { return n.toLocaleString('ko-KR') + '원'; }
    function setResult(id, n) {
      var el = document.getElementById(id);
      if (!el) return;
      el.innerHTML = fmt(n) + '<span class="calc-result-kr">' + toKoreanAmount(n) + '</span>';
    }
    function showErr(id, msg) {
      var el = document.getElementById(id);
      if (!el) return;
      el.textContent = msg;
      el.classList.toggle('is-visible', !!msg);
    }

    /* ── 현재 입력 모드 ── */
    function isRatioMode() {
      var a = document.querySelector('.calc-mode-btn.active');
      return !a || a.getAttribute('data-mode') === 'ratio';
    }
    function isCompare() {
      var a = document.querySelector('.calc-type-btn.active');
      return a && a.getAttribute('data-type') === 'compare';
    }

    /* ── 실시간 검증 ── */
    function validate() {
      var ok = true;
      if (isRatioMode()) {
        var total = toNum(document.getElementById('total-amount').value);
        var cr = toNum(document.getElementById('card-ratio').value);
        var nr = toNum(document.getElementById('cash-ratio').value);
        var wrap = document.getElementById('total-amount-wrap');
        if (total <= 0) {
          showErr('total-amount-err', '총 거래액을 입력해 주세요.');
          wrap && wrap.classList.add('is-error');
          ok = false;
        } else {
          showErr('total-amount-err', '');
          wrap && wrap.classList.remove('is-error');
        }
        var sumErr = Math.abs(cr + nr - 100) > 0.01 ? '카드 비율 + 현금 비율의 합이 100%여야 합니다. (현재 ' + (cr + nr).toFixed(1) + '%)' : '';
        showErr('ratio-sum-err', sumErr);
        var cardRatioEl = document.getElementById('card-ratio');
        var cashRatioEl = document.getElementById('cash-ratio');
        if (cardRatioEl) cardRatioEl.classList.toggle('is-error', !!sumErr);
        if (cashRatioEl) cashRatioEl.classList.toggle('is-error', !!sumErr);
        if (sumErr) ok = false;
      } else {
        var ca = toNum(document.getElementById('card-amount').value);
        var na = toNum(document.getElementById('cash-amount').value);
        if (ca <= 0 && na <= 0) {
          showErr('amount-sum-err', '카드 또는 현금 거래액을 입력해 주세요.');
          ok = false;
        } else {
          showErr('amount-sum-err', '');
        }
      }
      calcBtn.disabled = !ok;
      return ok;
    }

    /* ── 콤마 마스킹 + 한글 금액 ── */
    function updateAmountKr(inputId) {
      var el = document.getElementById(inputId);
      var krEl = document.getElementById(inputId + '-kr');
      if (!el || !krEl) return;
      var n = toNum(el.value);
      krEl.textContent = n > 0 ? toKoreanAmount(n) : '';
    }
    var amountInputIds = ['total-amount', 'card-amount', 'cash-amount'];
    amountInputIds.forEach(function (id) {
      var el = document.getElementById(id);
      if (!el) return;
      el.addEventListener('input', function () {
        var pos = this.selectionStart;
        var beforeLen = this.value.length;
        this.value = formatWithComma(this.value);
        var afterLen = this.value.length;
        var newPos = Math.max(0, pos + afterLen - beforeLen);
        try { this.setSelectionRange(newPos, newPos); } catch (e) {}
        updateAmountKr(id);
        validate();
      });
      updateAmountKr(id);
    });

    /* ── 비율 입력 실시간 검증 ── */
    ['card-ratio', 'cash-ratio'].forEach(function (id) {
      var el = document.getElementById(id);
      if (el) el.addEventListener('input', validate);
    });

    /* ── 탭: 입력 방식 전환 ── */
    var modeBtns = document.querySelectorAll('.calc-mode-btn');
    modeBtns.forEach(function (btn) {
      btn.addEventListener('click', function () {
        modeBtns.forEach(function (b) {
          b.classList.remove('active');
          b.setAttribute('aria-selected', 'false');
        });
        btn.classList.add('active');
        btn.setAttribute('aria-selected', 'true');
        var isRatio = btn.getAttribute('data-mode') === 'ratio';
        document.getElementById('calc-ratio').style.display = isRatio ? 'block' : 'none';
        document.getElementById('calc-amount').style.display = isRatio ? 'none' : 'block';
        validate();
      });
    });

    /* ── 탭: 단일 / A vs B 전환 ── */
    var typeBtns = document.querySelectorAll('.calc-type-btn');
    typeBtns.forEach(function (btn) {
      btn.addEventListener('click', function () {
        typeBtns.forEach(function (b) { b.classList.remove('active'); });
        btn.classList.add('active');
        var compare = isCompare();
        document.getElementById('calc-fee-single').style.display = compare ? 'none' : 'block';
        document.getElementById('calc-fee-compare').style.display = compare ? 'block' : 'none';
      });
    });

    /* ── 프리셋 ── */
    var PRESETS = {
      'general':    { cardRatio: 70,  cashRatio: 30 },
      'cash-heavy': { cardRatio: 40,  cashRatio: 60 },
      'card-only':  { cardRatio: 90,  cashRatio: 10 }
    };
    document.querySelectorAll('.calc-preset-btn').forEach(function (btn) {
      btn.addEventListener('click', function () {
        var p = PRESETS[btn.getAttribute('data-preset')];
        if (!p) return;
        /* 비율 모드로 전환 */
        var ratioBtn = document.querySelector('.calc-mode-btn[data-mode="ratio"]');
        if (ratioBtn && !ratioBtn.classList.contains('active')) ratioBtn.click();
        document.getElementById('card-ratio').value = p.cardRatio;
        document.getElementById('cash-ratio').value = p.cashRatio;
        validate();
      });
    });

    /* ── 계산 실행 ── */
    calcBtn.addEventListener('click', function () {
      if (!validate()) return;
      var isRatio = isRatioMode();
      var totalAmount = 0, cardAmount = 0, cashAmount = 0;
      var cardRatioPct = 0, cashRatioPct = 0;
      if (isRatio) {
        totalAmount  = toNum(document.getElementById('total-amount').value);
        cardRatioPct = toNum(document.getElementById('card-ratio').value);
        cashRatioPct = toNum(document.getElementById('cash-ratio').value);
        cardAmount   = Math.round(totalAmount * cardRatioPct / 100);
        cashAmount   = totalAmount - cardAmount;
      } else {
        cardAmount   = toNum(document.getElementById('card-amount').value);
        cashAmount   = toNum(document.getElementById('cash-amount').value);
        totalAmount  = cardAmount + cashAmount;
        cardRatioPct = totalAmount > 0 ? Math.round(cardAmount / totalAmount * 1000) / 10 : 0;
        cashRatioPct = totalAmount > 0 ? Math.round(cashAmount / totalAmount * 1000) / 10 : 0;
      }

      var compare = isCompare();
      document.getElementById('calc-result').style.display = 'block';
      document.getElementById('calc-result-single').style.display = compare ? 'none' : 'block';
      document.getElementById('calc-result-compare').style.display = compare ? 'block' : 'none';
      document.getElementById('result-rate-pct').style.display = compare ? 'none' : 'block';

      /* 조건 요약 */
      var summaryEl = document.getElementById('calc-result-summary');
      if (compare) {
        var crA = toNum(document.getElementById('card-rate-a').value);
        var nrA = toNum(document.getElementById('cash-rate-a').value);
        var crB = toNum(document.getElementById('card-rate-b').value);
        var nrB = toNum(document.getElementById('cash-rate-b').value);
        summaryEl.textContent = '총 ' + toKoreanAmount(totalAmount) + ' | 카드 ' + cardRatioPct + '% / 현금 ' + cashRatioPct + '% | PG A(카드 ' + crA + '% / 현금 ' + nrA + '%) vs PG B(카드 ' + crB + '% / 현금 ' + nrB + '%)';
        var feeA = Math.round(cardAmount * crA / 100 + cashAmount * nrA / 100);
        var feeB = Math.round(cardAmount * crB / 100 + cashAmount * nrB / 100);
        setResult('result-comp-total', totalAmount);
        setResult('result-fee-a', feeA);
        setResult('result-fee-b', feeB);
        setResult('result-save-amount', feeA - feeB);
      } else {
        var cardRate = toNum(document.getElementById('card-rate').value);
        var cashRate = toNum(document.getElementById('cash-rate').value);
        summaryEl.textContent = '총 ' + toKoreanAmount(totalAmount) + ' | 카드 ' + cardRatioPct + '% (수수료 ' + cardRate + '%) / 현금 ' + cashRatioPct + '% (수수료 ' + cashRate + '%)';
        var cardFee  = Math.round(cardAmount * cardRate / 100);
        var cashFee  = Math.round(cashAmount * cashRate / 100);
        var totalFee = cardFee + cashFee;
        var net      = totalAmount - totalFee;
        setResult('result-total-amount', totalAmount);
        setResult('result-card-amount',  cardAmount);
        setResult('result-cash-amount',  cashAmount);
        setResult('result-card-fee',     cardFee);
        setResult('result-cash-fee',     cashFee);
        setResult('result-total-fee',    totalFee);
        setResult('result-net',          net);
        var ratePct = totalAmount > 0 ? (totalFee / totalAmount * 100).toFixed(2) : '0';
        var ratePctEl = document.getElementById('result-rate-pct');
        if (ratePctEl) ratePctEl.textContent = '전체 수수료율 ' + ratePct + '% (총 거래액 대비)';
      }

      document.getElementById('calc-result').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      if (window.trackEvent) window.trackEvent('calc_run', { compare: compare });
    });

    /* ── 저장 / 공유 ── */
    function getSavedList() {
      try { return JSON.parse(localStorage.getItem(CALC_SAVED_KEY) || '[]'); } catch (e) { return []; }
    }
    function setSavedList(list) {
      try { localStorage.setItem(CALC_SAVED_KEY, JSON.stringify(list)); } catch (e) {}
    }
    function getFormState() {
      return {
        mode:      isRatioMode() ? 'ratio' : 'amount',
        type:      isCompare() ? 'compare' : 'single',
        totalAmount: toNum(document.getElementById('total-amount').value),
        cardRatio:   toNum(document.getElementById('card-ratio').value),
        cashRatio:   toNum(document.getElementById('cash-ratio').value),
        cardAmount:  toNum(document.getElementById('card-amount').value),
        cashAmount:  toNum(document.getElementById('cash-amount').value),
        cardRate:    toNum(document.getElementById('card-rate').value),
        cashRate:    toNum(document.getElementById('cash-rate').value),
        cardRateA:   toNum(document.getElementById('card-rate-a').value),
        cashRateA:   toNum(document.getElementById('cash-rate-a').value),
        cardRateB:   toNum(document.getElementById('card-rate-b').value),
        cashRateB:   toNum(document.getElementById('cash-rate-b').value)
      };
    }
    function setFormState(s) {
      if (!s) return;
      var mBtn = document.querySelector('.calc-mode-btn[data-mode="' + (s.mode || 'ratio') + '"]');
      if (mBtn) mBtn.click();
      var tBtn = document.querySelector('.calc-type-btn[data-type="' + (s.type || 'single') + '"]');
      if (tBtn) tBtn.click();
      document.getElementById('total-amount').value = formatWithComma(String(s.totalAmount || 0));
      document.getElementById('card-ratio').value   = s.cardRatio  != null ? s.cardRatio  : 70;
      document.getElementById('cash-ratio').value   = s.cashRatio  != null ? s.cashRatio  : 30;
      document.getElementById('card-amount').value  = formatWithComma(String(s.cardAmount  || 0));
      document.getElementById('cash-amount').value  = formatWithComma(String(s.cashAmount  || 0));
      document.getElementById('card-rate').value    = s.cardRate   != null ? s.cardRate   : 3.2;
      document.getElementById('cash-rate').value    = s.cashRate   != null ? s.cashRate   : 2;
      document.getElementById('card-rate-a').value  = s.cardRateA  != null ? s.cardRateA  : 3.2;
      document.getElementById('cash-rate-a').value  = s.cashRateA  != null ? s.cashRateA  : 2;
      document.getElementById('card-rate-b').value  = s.cardRateB  != null ? s.cardRateB  : 2.8;
      document.getElementById('cash-rate-b').value  = s.cashRateB  != null ? s.cashRateB  : 1.5;
      amountInputIds.forEach(updateAmountKr);
      validate();
    }

    document.getElementById('calc-save').addEventListener('click', function () {
      var name = prompt('저장할 이름을 입력하세요.', 'PG 비교 ' + new Date().toLocaleDateString('ko-KR'));
      if (name == null || !(name = name.trim())) return;
      var list = getSavedList();
      list.unshift({ id: 'calc_' + Date.now(), name: name, createdAt: Date.now(), params: getFormState() });
      setSavedList(list);
      var btn = this; btn.textContent = '저장됨';
      setTimeout(function () { btn.textContent = '저장'; }, 2000);
    });

    document.getElementById('calc-share').addEventListener('click', function () {
      var s = getFormState();
      var q = [
        'mode=' + s.mode, 'type=' + s.type,
        'total=' + s.totalAmount,
        'cardRatio=' + s.cardRatio, 'cashRatio=' + s.cashRatio,
        'cardRate=' + s.cardRate,   'cashRate=' + s.cashRate,
        'cardRateA=' + s.cardRateA, 'cashRateA=' + s.cashRateA,
        'cardRateB=' + s.cardRateB, 'cashRateB=' + s.cashRateB
      ];
      var url = location.origin + location.pathname + '?' + q.join('&');
      var btn = this;
      try {
        navigator.clipboard.writeText(url).then(function () {
          btn.textContent = '복사됨';
          setTimeout(function () { btn.textContent = '링크 공유'; }, 2000);
        });
      } catch (e) { prompt('아래 URL을 복사하세요.', url); }
      if (window.trackEvent) window.trackEvent('share', { type: 'calc_url' });
    });

    document.getElementById('calc-image-save').addEventListener('click', function () {
      var resultEl = document.getElementById('calc-result');
      if (!resultEl || resultEl.style.display === 'none') {
        alert('먼저 수수료를 계산해 주세요.');
        return;
      }
      var summary = (document.getElementById('calc-result-summary') || {}).textContent || '';
      var lines = [ '가맹점숲 수수료 계산 결과', summary ];
      var singleList = document.getElementById('calc-result-single');
      var compareList = document.getElementById('calc-result-compare');
      if (singleList && singleList.style.display !== 'none') {
        var dts = singleList.querySelectorAll('dt');
        var dds = singleList.querySelectorAll('dd');
        for (var i = 0; i < dts.length && i < dds.length; i++) {
          lines.push((dts[i].textContent || '').trim() + ' ' + (dds[i].textContent || '').trim());
        }
      }
      if (compareList && compareList.style.display !== 'none') {
        var dts2 = compareList.querySelectorAll('dt');
        var dds2 = compareList.querySelectorAll('dd');
        for (var j = 0; j < dts2.length && j < dds2.length; j++) {
          lines.push((dts2[j].textContent || '').trim() + ' ' + (dds2[j].textContent || '').trim());
        }
      }
      var canvas = document.createElement('canvas');
      var w = 480; var h = 80 + lines.length * 28;
      canvas.width = w; canvas.height = h;
      var ctx = canvas.getContext('2d');
      ctx.fillStyle = '#0f172a';
      ctx.fillRect(0, 0, w, h);
      ctx.fillStyle = '#f8fafc';
      ctx.font = 'bold 18px sans-serif';
      ctx.fillText(lines[0] || '수수료 계산 결과', 24, 36);
      ctx.font = '14px sans-serif';
      for (var k = 1; k < lines.length; k++) {
        ctx.fillText(lines[k], 24, 56 + k * 26);
      }
      try {
        canvas.toBlob(function (blob) {
          var a = document.createElement('a');
          a.download = 'gmp-calc-result-' + Date.now() + '.png';
          a.href = URL.createObjectURL(blob);
          a.click();
          URL.revokeObjectURL(a.href);
        });
      } catch (e) {
        alert('이미지 저장을 지원하지 않는 브라우저입니다.');
      }
      if (window.trackEvent) window.trackEvent('share', { type: 'calc_image' });
    });

    /* ── URL 파라미터 복원 ── */
    var params = new URLSearchParams(location.search);
    var loadId = params.get('load');
    if (loadId) {
      var found = getSavedList().filter(function (x) { return x.id === loadId; })[0];
      if (found && found.params) setFormState(found.params);
    } else if (params.get('total') != null) {
      setFormState({
        mode: params.get('mode') || 'ratio',
        type: params.get('type') || 'single',
        totalAmount: toNum(params.get('total')),
        cardRatio: toNum(params.get('cardRatio')) || 70,
        cashRatio: toNum(params.get('cashRatio')) || 30,
        cardRate:  toNum(params.get('cardRate'))  || 3.2,
        cashRate:  toNum(params.get('cashRate'))  || 2,
        cardRateA: toNum(params.get('cardRateA')) || 3.2,
        cashRateA: toNum(params.get('cashRateA')) || 2,
        cardRateB: toNum(params.get('cardRateB')) || 2.8,
        cashRateB: toNum(params.get('cashRateB')) || 1.5
      });
    }

    /* ── 초기 검증 ── */
    validate();

  })();
  </script>
  <!-- 모바일 드로어 -->
  <div id="drawerOverlay" hidden aria-hidden="true"></div>
  <aside id="mobileDrawer" hidden aria-hidden="true" role="dialog" aria-modal="true" aria-label="메뉴">
    <div class="drawer-header">
      <span class="drawer-logo">가맹점숲</span>
      <button type="button" class="drawer-close" aria-label="메뉴 닫기">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true"><path d="M4 4L16 16M16 4L4 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      </button>
    </div>
    <nav class="drawer-nav" aria-label="모바일 메뉴">
      <a href="community.html"  class="drawer-link">커뮤니티</a>
      <a href="pg.html"         class="drawer-link">PG 수수료 표</a>
      <a href="calculator.html" class="drawer-link active">수수료 계산기</a>
      <a href="news.html"       class="drawer-link">뉴스</a>
      <a href="verify.html"     class="drawer-link">인증/문의</a>
    </nav>
  </aside>
  <script src="js/drawer.js"></script>
</body>
</html>
