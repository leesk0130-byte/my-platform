<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0f172a">
  <title>결제 수수료 계산기 | 가맹점숲 - PG 수수료 계산</title>
  <meta name="description" content="카드·현금 비율과 금액을 넣으면 PG 결제 수수료를 한 번에 계산. 온라인 쇼핑몰·가맹점 사장님 필수 결제 수수료 계산기.">
  <meta name="keywords" content="가맹점숲, 결제 수수료 계산기, PG 수수료, 수수료 계산기, 온라인 가맹점, PG, 온라인쇼핑몰">
  <link rel="canonical" href="https://my-platform.pages.dev/calculator.html">
  <meta property="og:type" content="website">
  <meta property="og:title" content="결제수수료 계산기 | 가맹점숲">
  <meta property="og:description" content="카드·현금 비율과 금액을 넣으면 PG 결제수수료를 한 번에 계산. 사장님 필수.">
  <meta property="og:url" content="https://my-platform.pages.dev/calculator.html">
  <meta property="og:locale" content="ko_KR">
  <meta property="og:image" content="https://my-platform.pages.dev/og-image.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="결제수수료 계산기 | 가맹점숲">
  <meta name="twitter:description" content="카드·현금 비율과 금액을 넣으면 PG 결제수수료를 한 번에 계산. 사장님 필수.">
  <meta name="twitter:image" content="https://my-platform.pages.dev/og-image.png">
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"SoftwareApplication","name":"결제 수수료 계산기 | 가맹점숲","applicationCategory":"FinanceApplication","description":"카드·현금 비율과 금액을 넣으면 PG 결제 수수료를 한 번에 계산. 온라인 가맹점·쇼핑몰 사장님 필수 도구.","url":"https://my-platform.pages.dev/calculator.html","operatingSystem":"Any","offers":{"@type":"Offer","price":"0","priceCurrency":"KRW"},"author":{"@type":"Organization","name":"가맹점숲","url":"https://my-platform.pages.dev/"}}
  </script>
  <link rel="stylesheet" href="css/common.css">
  <style>
    /* common.css 로드 실패 시 계산기 페이지만이라도 보이도록 필수 스타일 */
    body { font-family: 'Pretendard', -apple-system, sans-serif; line-height: 1.65; color: #0f172a; background: #f8fafc; margin: 0; }
    a { color: #0d9488; text-decoration: none; }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem 2rem; }
    header { background: #0f172a; color: #fff; padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
    header h1 { font-size: 1.25rem; margin: 0; }
    header h1 a { color: #fff; }
    .header-nav { display: flex; gap: 2rem; }
    .header-nav a { color: #94a3b8; font-weight: 500; }
    .header-nav a:hover, .header-nav a.active { color: #fff; }
    .header-auth { display: flex; gap: 0.5rem; }
    .btn { display: inline-block; padding: 0.5rem 1rem; border-radius: 12px; font-size: 0.9rem; font-weight: 600; cursor: pointer; border: none; }
    .btn-outline { background: transparent; color: #94a3b8; border: 1px solid #475569; }
    .btn-outline:hover { background: #334155; color: #fff; }
    .btn-primary { background: linear-gradient(135deg, #0d9488, #0f766e); color: #fff; }
    .btn-primary:hover { opacity: 0.95; }
    .breadcrumb { font-size: 0.875rem; color: #64748b; margin-bottom: 0.75rem; }
    .breadcrumb a { color: #64748b; }
    .bc-sep { margin: 0 0.25rem; color: #94a3b8; }
    .hero { background: linear-gradient(135deg, #0d9488 0%, #0f766e 50%, #115e59 100%); color: #fff; padding: 2.5rem 2rem; border-radius: 20px; text-align: center; margin-bottom: 2rem; }
    .hero h2 { font-size: 1.75rem; margin-bottom: 0.5rem; }
    .hero p { opacity: 0.95; font-size: 1.05rem; margin: 0; }
    .card { background: #fff; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); overflow: hidden; }
    .card-content { padding: 1.5rem 2rem; }
    .section { margin-bottom: 2rem; }
    .section-title { font-size: 1.1rem; font-weight: 700; padding: 1rem 1.25rem; border-bottom: 1px solid #f1f5f9; margin: 0; }
    .form-group { margin-bottom: 1rem; }
    .form-group label { display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.35rem; color: #475569; }
    .form-group input, .form-group select { width: 100%; padding: 0.6rem 0.85rem; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 1rem; box-sizing: border-box; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    @media (max-width: 600px) { .form-row { grid-template-columns: 1fr; } }
    .calc-mode-tabs { display: flex; margin-bottom: 1.25rem; }
    .calc-mode-btn { padding: 0.75rem 1.25rem; border: 1px solid #e2e8f0; background: #f8fafc; font-size: 0.875rem; font-weight: 600; cursor: pointer; border-radius: 0; }
    .calc-mode-btn:first-child { border-radius: 12px 0 0 12px; }
    .calc-mode-btn:last-child { border-radius: 0 12px 12px 0; border-left: none; }
    .calc-mode-btn.active { background: #0d9488; color: #fff; border-color: #0d9488; }
    .calc-type-btn { padding: 0.5rem 1rem; border: 1px solid #e2e8f0; background: #f8fafc; font-size: 0.875rem; font-weight: 600; cursor: pointer; border-radius: 8px; margin-right: 0.5rem; }
    .calc-type-btn.active { background: #0d9488; color: #fff; border-color: #0d9488; }
    .calc-desc { font-size: 0.875rem; color: #64748b; margin-bottom: 1rem; }
    .calc-panel { margin-bottom: 1.5rem; }
    .calc-fee-rates { margin-bottom: 1.5rem; padding-top: 1rem; border-top: 1px solid #f1f5f9; }
    .calc-actions { margin-bottom: 1.5rem; }
    .calc-result { padding: 1.5rem; background: #f0fdfa; border: 1px solid #99f6e4; border-radius: 12px; }
    .calc-result-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 1rem; color: #0f766e; }
    .calc-result-list { display: grid; grid-template-columns: auto 1fr; gap: 0.5rem 1.5rem; align-items: baseline; }
    .calc-result-list dt { font-weight: 600; color: #475569; }
    .calc-result-list dd { margin: 0; font-weight: 600; color: #0f172a; }
    .calc-result-list dt.calc-result-total, .calc-result-list dd.calc-result-total { font-size: 1.1rem; margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #99f6e4; color: #0f766e; }
    .calc-result-list dd .calc-result-kr { display: block; font-size: 0.875rem; font-weight: 500; color: #64748b; margin-top: 0.25rem; }
    footer { background: #0f172a; color: #94a3b8; padding: 2rem 1.5rem; margin-top: 2.5rem; font-size: 0.875rem; }
    .footer-inner { max-width: 1200px; margin: 0 auto; text-align: center; }
    .footer-inner a { color: #cbd5e1; }
    .footer-contact { margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #334155; }
    .footer-contact h4 { font-size: 0.875rem; font-weight: 700; color: #fff; margin-bottom: 1rem; }
    .footer-contact p { margin: 0.25rem 0; font-size: 0.875rem; }
    /* 입력창 안에 숫자 오른쪽에 한글 금액 (같은 창으로 보이게) */
    .input-with-kr {
      display: flex;
      align-items: center;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      background: #fff;
      padding: 0 1rem;
      min-height: 2.75rem;
      box-sizing: border-box;
    }
    .input-with-kr input {
      flex: 1;
      min-width: 0;
      border: none;
      background: none;
      padding: 0.65rem 0;
      font-size: 1rem;
    }
    .input-with-kr input:focus { outline: none; }
    .calc-input-kr {
      font-size: 0.875rem;
      color: #64748b;
      opacity: 0.7;
      white-space: nowrap;
      margin-left: 0.5rem;
    }
  </style>
  <script src="js/analytics-stub.js"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3006893636342653" crossorigin="anonymous"></script>
</head>
<body>
  <a href="#main" class="skip-link">본문으로 건너뛰기</a>
  <header>
    <h1><a href="index.html">가맹점숲</a></h1>
    <button type="button" class="nav-toggle" aria-label="메뉴 열기" aria-expanded="false" data-toggle-nav><span></span><span></span><span></span></button>
    <nav class="header-nav" id="headerNav" aria-label="메인 메뉴">
      <a href="community.html">커뮤니티</a>
      <a href="pg.html">PG 수수료</a>
      <a href="calculator.html" class="active">수수료 비교 계산기</a>
      <a href="news.html">최신 공지/뉴스</a>
      <a href="verify.html">인증/제휴 문의</a>
    </nav>
    <div class="header-auth" id="headerAuth" aria-label="로그인 상태">
      <div id="auth-actions"></div>
    </div>
  </header>

  <main id="main" class="container page-calculator">
    <nav class="breadcrumb" aria-label="breadcrumb"><a href="index.html">홈</a> <span class="bc-sep">/</span> <strong>결제수수료 계산기</strong></nav>
    <div class="hero">
      <h2>결제수수료 계산기</h2>
      <p>총 거래액과 <strong>카드/현금 비율</strong> 또는 <strong>카드·현금 금액</strong>을 넣으면 PG 수수료를 바로 계산해 드려요.</p>
      <p class="hero-hint">월 매출에서 카드·현금 비율과 수수료율만 입력하면 예상 수수료가 나옵니다. PG사 비교할 때 참고하세요.</p>
    </div>

    <section class="section">
      <div class="card card-content">
        <p class="calc-desc" style="margin-bottom:0.75rem;"><a href="calculator-saved.html">저장한 계산 목록</a></p>
        <div class="calc-mode-tabs" style="margin-bottom:0.5rem;">
          <button type="button" class="calc-mode-btn active" data-mode="ratio">비율로 입력</button>
          <button type="button" class="calc-mode-btn" data-mode="amount">금액으로 입력</button>
        </div>
        <div class="calc-mode-tabs">
          <button type="button" class="calc-type-btn active" data-type="single">단일 계산</button>
          <button type="button" class="calc-type-btn" data-type="compare">A vs B 비교</button>
        </div>

        <div id="calc-ratio" class="calc-panel">
          <p class="calc-desc">총 거래액과 카드·현금 비율(%)을 입력하세요. (비율 합 100%)</p>
          <div class="form-group">
            <label for="total-amount">총 거래액 (원)</label>
            <div class="input-with-kr">
              <input type="text" id="total-amount" inputmode="numeric" placeholder="예: 10,000,000" autocomplete="off">
              <span class="calc-input-kr" id="total-amount-kr" aria-hidden="true"></span>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="card-ratio">카드 비율 (%)</label>
              <input type="number" id="card-ratio" placeholder="예: 70" min="0" max="100" step="0.1" value="70">
            </div>
            <div class="form-group">
              <label for="cash-ratio">현금·실시간이체 비율 (%)</label>
              <input type="number" id="cash-ratio" placeholder="예: 30" min="0" max="100" step="0.1" value="30">
            </div>
          </div>
        </div>

        <div id="calc-amount" class="calc-panel" style="display:none;">
          <p class="calc-desc">카드 거래액과 현금(실시간이체 등) 거래액을 직접 입력하세요.</p>
          <div class="form-row">
            <div class="form-group">
              <label for="card-amount">카드 거래액 (원)</label>
              <div class="input-with-kr">
                <input type="text" id="card-amount" inputmode="numeric" placeholder="예: 7,000,000" autocomplete="off">
                <span class="calc-input-kr" id="card-amount-kr" aria-hidden="true"></span>
              </div>
            </div>
            <div class="form-group">
              <label for="cash-amount">현금·실시간이체 거래액 (원)</label>
              <div class="input-with-kr">
                <input type="text" id="cash-amount" inputmode="numeric" placeholder="예: 3,000,000" autocomplete="off">
                <span class="calc-input-kr" id="cash-amount-kr" aria-hidden="true"></span>
              </div>
            </div>
          </div>
        </div>

        <div id="calc-fee-single" class="calc-fee-rates">
          <p class="calc-desc">본인 PG 계약 조건에 맞는 수수료율(%)을 입력하세요. <a href="pg.html">PG 수수료 참고</a></p>
          <div class="form-row">
            <div class="form-group">
              <label for="card-rate">카드 수수료율 (%)</label>
              <input type="number" id="card-rate" placeholder="예: 3.2" min="0" max="100" step="0.01" value="3.2">
            </div>
            <div class="form-group">
              <label for="cash-rate">현금·실시간이체 수수료율 (%)</label>
              <input type="number" id="cash-rate" placeholder="예: 2" min="0" max="100" step="0.01" value="2">
            </div>
          </div>
        </div>
        <div id="calc-fee-compare" class="calc-fee-rates" style="display:none;">
          <p class="calc-desc">PG A와 B의 수수료율을 각각 입력하세요. <a href="pg.html">PG 수수료 참고</a></p>
          <div class="form-row">
            <div class="form-group">
              <label for="card-rate-a">PG A 카드 수수료율 (%)</label>
              <input type="number" id="card-rate-a" placeholder="예: 3.2" min="0" max="100" step="0.01" value="3.2">
            </div>
            <div class="form-group">
              <label for="cash-rate-a">PG A 현금 수수료율 (%)</label>
              <input type="number" id="cash-rate-a" placeholder="예: 2" min="0" max="100" step="0.01" value="2">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="card-rate-b">PG B 카드 수수료율 (%)</label>
              <input type="number" id="card-rate-b" placeholder="예: 2.8" min="0" max="100" step="0.01" value="2.8">
            </div>
            <div class="form-group">
              <label for="cash-rate-b">PG B 현금 수수료율 (%)</label>
              <input type="number" id="cash-rate-b" placeholder="예: 1.5" min="0" max="100" step="0.01" value="1.5">
            </div>
          </div>
        </div>

        <div class="calc-actions">
          <button type="button" class="btn btn-primary" id="calc-do">수수료 계산하기</button>
          <button type="button" class="btn btn-outline" id="calc-save">저장</button>
          <button type="button" class="btn btn-outline" id="calc-share">공유 URL 복사</button>
        </div>

        <div id="calc-result" class="calc-result" style="display:none;">
          <h4 class="calc-result-title">계산 결과</h4>
          <dl class="calc-result-list" id="calc-result-single">
            <dt>총 거래액</dt>
            <dd id="result-total-amount">0원</dd>
            <dt>카드 거래액</dt>
            <dd id="result-card-amount">0원</dd>
            <dt>현금·실시간이체 거래액</dt>
            <dd id="result-cash-amount">0원</dd>
            <dt>카드 수수료</dt>
            <dd id="result-card-fee">0원</dd>
            <dt>현금 수수료</dt>
            <dd id="result-cash-fee">0원</dd>
            <dt class="calc-result-total">총 수수료</dt>
            <dd class="calc-result-total" id="result-total-fee">0원</dd>
            <dt>실 수령 예상</dt>
            <dd id="result-net">0원</dd>
          </dl>
          <dl class="calc-result-list" id="calc-result-compare" style="display:none;">
            <dt>총 거래액</dt>
            <dd id="result-comp-total">0원</dd>
            <dt>PG A 총 수수료</dt>
            <dd id="result-fee-a">0원</dd>
            <dt>PG B 총 수수료</dt>
            <dd id="result-fee-b">0원</dd>
            <dt class="calc-result-total">절감액 (B 기준)</dt>
            <dd class="calc-result-total" id="result-save-amount">0원</dd>
          </dl>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-inner">
      <p><a href="about.html">가맹점숲이란?</a> | <a href="must-know.html">꼭 알아야 할 것</a> | <a href="terms.html">이용약관</a> | <a href="privacy.html">개인정보처리방침</a> | <a href="verify.html">인증/제휴 문의</a></p>
      <p>© 2025–2026 가맹점숲. All rights reserved.</p>
      <div class="footer-contact">
        <h4>문의</h4>
        <p>이메일: <a href="mailto:leesk0130@naver.com?subject=가맹점숲 문의">leesk0130@naver.com</a></p>
        <p class="footer-hours">운영 시간: 평일 09:00–18:00 (답변은 1–2 영업일 내)</p>
      </div>
    </div>
  </footer>

  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="js/config.js"></script>
  <script src="js/app.js"></script>
  <script src="js/auth.js"></script>
  <script>
    (function() {
      if (window.trackEvent) window.trackEvent('pageview', { page: 'calculator' });
      var CALC_SAVED_KEY = 'gmp_calc_saved';
      var typeBtns = document.querySelectorAll('.calc-type-btn');
      var isCompare = function() { return document.querySelector('.calc-type-btn.active').getAttribute('data-type') === 'compare'; };
      typeBtns.forEach(function(btn) {
        btn.addEventListener('click', function() {
          typeBtns.forEach(function(b) { b.classList.remove('active'); });
          btn.classList.add('active');
          var compare = isCompare();
          document.getElementById('calc-fee-single').style.display = compare ? 'none' : 'block';
          document.getElementById('calc-fee-compare').style.display = compare ? 'block' : 'none';
          document.getElementById('calc-result-single').style.display = compare ? 'none' : 'block';
          document.getElementById('calc-result-compare').style.display = compare ? 'block' : 'none';
        });
      });
      var btns = document.querySelectorAll('.calc-mode-btn');
      btns.forEach(function(btn) {
        btn.addEventListener('click', function() {
          var mode = btn.getAttribute('data-mode');
          btns.forEach(function(b) { b.classList.remove('active'); });
          btn.classList.add('active');
          document.getElementById('calc-ratio').style.display = mode === 'ratio' ? 'block' : 'none';
          document.getElementById('calc-amount').style.display = mode === 'amount' ? 'block' : 'none';
        });
      });

      function toNum(val) {
        var n = parseFloat(String(val).replace(/,/g, ''), 10);
        return isNaN(n) ? 0 : n;
      }
      function formatWithComma(val) {
        var digits = String(val).replace(/\D/g, '');
        if (digits === '') return '';
        var n = parseInt(digits, 10);
        return isNaN(n) ? '' : n.toLocaleString('ko-KR');
      }
      function toKoreanAmount(n) {
        n = Math.floor(n);
        if (n >= 1e8) {
          var eok = Math.floor(n / 1e8);
          var man = Math.floor((n % 1e8) / 1e4);
          var rest = n % 1e4;
          var s = eok + '억';
          if (man > 0) s += ' ' + man.toLocaleString('ko-KR') + '만';
          if (rest > 0) s += ' ' + rest.toLocaleString('ko-KR');
          return s + '원';
        }
        if (n >= 1e4) {
          var man = Math.floor(n / 1e4);
          var rest = n % 1e4;
          var s = man.toLocaleString('ko-KR') + '만';
          if (rest > 0) s += ' ' + rest.toLocaleString('ko-KR');
          return s + '원';
        }
        return n.toLocaleString('ko-KR') + '원';
      }

      function updateAmountKr(inputId) {
        var el = document.getElementById(inputId);
        var krEl = document.getElementById(inputId + '-kr');
        if (!el || !krEl) return;
        var n = toNum(el.value);
        krEl.textContent = n > 0 ? toKoreanAmount(n) : '';
      }
      var amountInputIds = ['total-amount', 'card-amount', 'cash-amount'];
      amountInputIds.forEach(function(id) {
        var el = document.getElementById(id);
        if (!el) return;
        el.addEventListener('input', function() {
          this.value = formatWithComma(this.value);
          this.setSelectionRange(this.value.length, this.value.length);
          updateAmountKr(id);
        });
        updateAmountKr(id);
      });

      function getAmounts() {
        var isRatio = document.querySelector('.calc-mode-btn.active').getAttribute('data-mode') === 'ratio';
        var totalAmount = 0, cardAmount = 0, cashAmount = 0;
        if (isRatio) {
          totalAmount = toNum(document.getElementById('total-amount').value);
          var cardRatio = toNum(document.getElementById('card-ratio').value);
          var cashRatio = toNum(document.getElementById('cash-ratio').value);
          cardAmount = Math.round(totalAmount * cardRatio / 100);
          cashAmount = totalAmount - cardAmount;
        } else {
          cardAmount = toNum(document.getElementById('card-amount').value);
          cashAmount = toNum(document.getElementById('cash-amount').value);
          totalAmount = cardAmount + cashAmount;
        }
        return { totalAmount: totalAmount, cardAmount: cardAmount, cashAmount: cashAmount };
      }
      function fmt(n) { return n.toLocaleString('ko-KR') + '원'; }
      function setResult(id, n) {
        var el = document.getElementById(id);
        if (!el) return;
        el.innerHTML = fmt(n) + '<span class="calc-result-kr">' + toKoreanAmount(n) + '</span>';
      }

      document.getElementById('calc-do').addEventListener('click', function() {
        var isRatio = document.querySelector('.calc-mode-btn.active').getAttribute('data-mode') === 'ratio';
        var totalAmount = 0, cardAmount = 0, cashAmount = 0;
        if (isRatio) {
          totalAmount = toNum(document.getElementById('total-amount').value);
          var cardRatio = toNum(document.getElementById('card-ratio').value);
          var cashRatio = toNum(document.getElementById('cash-ratio').value);
          if (totalAmount <= 0) { alert('총 거래액을 입력해 주세요.'); return; }
          if (Math.abs(cardRatio + cashRatio - 100) > 0.01) { alert('카드 비율과 현금 비율의 합이 100%가 되어야 해요.'); return; }
          cardAmount = Math.round(totalAmount * cardRatio / 100);
          cashAmount = totalAmount - cardAmount;
        } else {
          cardAmount = toNum(document.getElementById('card-amount').value);
          cashAmount = toNum(document.getElementById('cash-amount').value);
          totalAmount = cardAmount + cashAmount;
          if (totalAmount <= 0) { alert('카드 또는 현금 거래액을 입력해 주세요.'); return; }
        }
        var compare = isCompare();
        document.getElementById('calc-result').style.display = 'block';
        document.getElementById('calc-result-single').style.display = compare ? 'none' : 'block';
        document.getElementById('calc-result-compare').style.display = compare ? 'block' : 'none';
        if (compare) {
          var cardRateA = toNum(document.getElementById('card-rate-a').value) / 100;
          var cashRateA = toNum(document.getElementById('cash-rate-a').value) / 100;
          var cardRateB = toNum(document.getElementById('card-rate-b').value) / 100;
          var cashRateB = toNum(document.getElementById('cash-rate-b').value) / 100;
          var feeA = Math.round(cardAmount * cardRateA + cashAmount * cashRateA);
          var feeB = Math.round(cardAmount * cardRateB + cashAmount * cashRateB);
          var saveAmount = feeA - feeB;
          setResult('result-comp-total', totalAmount);
          setResult('result-fee-a', feeA);
          setResult('result-fee-b', feeB);
          setResult('result-save-amount', saveAmount);
        } else {
          var cardRate = toNum(document.getElementById('card-rate').value) / 100;
          var cashRate = toNum(document.getElementById('cash-rate').value) / 100;
          var cardFee = Math.round(cardAmount * cardRate);
          var cashFee = Math.round(cashAmount * cashRate);
          var totalFee = cardFee + cashFee;
          var net = totalAmount - totalFee;
          setResult('result-total-amount', totalAmount);
          setResult('result-card-amount', cardAmount);
          setResult('result-cash-amount', cashAmount);
          setResult('result-card-fee', cardFee);
          setResult('result-cash-fee', cashFee);
          setResult('result-total-fee', totalFee);
          setResult('result-net', net);
        }
        if (window.trackEvent) window.trackEvent('calc_run', {});
      });

      function getSavedList() {
        try {
          var raw = localStorage.getItem(CALC_SAVED_KEY);
          return raw ? JSON.parse(raw) : [];
        } catch (e) { return []; }
      }
      function setSavedList(list) {
        try { localStorage.setItem(CALC_SAVED_KEY, JSON.stringify(list)); } catch (e) {}
      }
      function getFormState() {
        var isRatio = document.querySelector('.calc-mode-btn.active').getAttribute('data-mode') === 'ratio';
        var compare = isCompare();
        var state = {
          mode: isRatio ? 'ratio' : 'amount',
          type: compare ? 'compare' : 'single',
          totalAmount: toNum(document.getElementById('total-amount').value),
          cardRatio: toNum(document.getElementById('card-ratio').value),
          cashRatio: toNum(document.getElementById('cash-ratio').value),
          cardAmount: toNum(document.getElementById('card-amount').value),
          cashAmount: toNum(document.getElementById('cash-amount').value),
          cardRate: toNum(document.getElementById('card-rate').value),
          cashRate: toNum(document.getElementById('cash-rate').value),
          cardRateA: toNum(document.getElementById('card-rate-a').value),
          cashRateA: toNum(document.getElementById('cash-rate-a').value),
          cardRateB: toNum(document.getElementById('card-rate-b').value),
          cashRateB: toNum(document.getElementById('cash-rate-b').value)
        };
        return state;
      }
      function setFormState(state) {
        if (!state) return;
        document.querySelector('.calc-mode-btn[data-mode="' + (state.mode || 'ratio') + '"]').click();
        document.querySelector('.calc-type-btn[data-type="' + (state.type || 'single') + '"]').click();
        document.getElementById('total-amount').value = formatWithComma(String(state.totalAmount || 0));
        document.getElementById('card-ratio').value = state.cardRatio != null ? state.cardRatio : 70;
        document.getElementById('cash-ratio').value = state.cashRatio != null ? state.cashRatio : 30;
        document.getElementById('card-amount').value = formatWithComma(String(state.cardAmount || 0));
        document.getElementById('cash-amount').value = formatWithComma(String(state.cashAmount || 0));
        document.getElementById('card-rate').value = state.cardRate != null ? state.cardRate : 3.2;
        document.getElementById('cash-rate').value = state.cashRate != null ? state.cashRate : 2;
        document.getElementById('card-rate-a').value = state.cardRateA != null ? state.cardRateA : 3.2;
        document.getElementById('cash-rate-a').value = state.cashRateA != null ? state.cashRateA : 2;
        document.getElementById('card-rate-b').value = state.cardRateB != null ? state.cardRateB : 2.8;
        document.getElementById('cash-rate-b').value = state.cashRateB != null ? state.cashRateB : 1.5;
        amountInputIds.forEach(function(id) { updateAmountKr(id); });
      }
      document.getElementById('calc-save').addEventListener('click', function() {
        var name = prompt('저장할 이름을 입력하세요.', 'PG 비교 ' + new Date().toLocaleDateString('ko-KR'));
        if (name == null || (name = (name || '').trim()) === '') return;
        var list = getSavedList();
        var item = { id: 'calc_' + Date.now(), name: name, createdAt: Date.now(), params: getFormState() };
        list.unshift(item);
        setSavedList(list);
        alert('저장되었습니다.');
      });
      document.getElementById('calc-share').addEventListener('click', function() {
        var s = getFormState();
        var q = [];
        q.push('mode=' + encodeURIComponent(s.mode || 'ratio'));
        q.push('type=' + encodeURIComponent(s.type || 'single'));
        q.push('total=' + (s.totalAmount || 0));
        q.push('cardRatio=' + (s.cardRatio || 70));
        q.push('cashRatio=' + (s.cashRatio || 30));
        q.push('cardRate=' + (s.cardRate || 3.2));
        q.push('cashRate=' + (s.cashRate || 2));
        q.push('cardRateA=' + (s.cardRateA != null ? s.cardRateA : 3.2));
        q.push('cashRateA=' + (s.cashRateA != null ? s.cashRateA : 2));
        q.push('cardRateB=' + (s.cardRateB != null ? s.cardRateB : 2.8));
        q.push('cashRateB=' + (s.cashRateB != null ? s.cashRateB : 1.5));
        var url = location.origin + location.pathname + '?' + q.join('&');
        try {
          navigator.clipboard.writeText(url);
          this.textContent = '복사됨';
          var btn = this;
          setTimeout(function() { btn.textContent = '공유 URL 복사'; }, 2000);
        } catch (e) { prompt('아래 URL을 복사하세요', url); }
      });
      var params = new URLSearchParams(location.search);
      var loadId = params.get('load');
      if (loadId) {
        var list = getSavedList();
        var found = list.filter(function(x) { return x.id === loadId; })[0];
        if (found && found.params) setFormState(found.params);
      } else {
        var total = params.get('total');
        if (total != null) {
          var state = {
            mode: params.get('mode') || 'ratio',
            type: params.get('type') || 'single',
            totalAmount: toNum(total),
            cardRatio: toNum(params.get('cardRatio')) || 70,
            cashRatio: toNum(params.get('cashRatio')) || 30,
            cardRate: toNum(params.get('cardRate')) || 3.2,
            cashRate: toNum(params.get('cashRate')) || 2,
            cardRateA: toNum(params.get('cardRateA')) || 3.2,
            cashRateA: toNum(params.get('cashRateA')) || 2,
            cardRateB: toNum(params.get('cardRateB')) || 2.8,
            cashRateB: toNum(params.get('cashRateB')) || 1.5
          };
          setFormState(state);
        }
      }
    })();
    function toggleNav() {
      var nav = document.getElementById('headerNav');
      var btn = document.querySelector('.nav-toggle');
      if (!nav || !btn) return;
      var open = nav.classList.toggle('is-open');
      btn.setAttribute('aria-expanded', open);
      btn.setAttribute('aria-label', open ? '메뉴 닫기' : '메뉴 열기');
    }
  </script>
</body>
</html>
