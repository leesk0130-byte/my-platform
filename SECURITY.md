# 보안 가이드 (가맹점숲)

## 현재 구조 요약

- **호스팅**: Cloudflare Pages (HTTPS 기본 적용)
- **인증**: Firebase Auth (이메일/비밀번호)
- **데이터**: 커뮤니티·댓글은 서버 없이 localStorage + 클라이언트 JS (API 미연동 시)

---

## 1. 환경 변수 관리

- **Firebase 설정**: API 키·프로젝트 ID는 `js/config.js` 또는 환경별 설정으로 관리합니다.
- **GitHub 노출 방지**: API 키·비밀번호는 **코드에 직접 넣지 마세요**. Cloudflare Pages에서는 **Environment Variables**에 설정하고, 빌드 시 주입하거나 `config.js`를 서버에서 동적 생성하는 방식을 권장합니다.
- **.env**: 백엔드를 도입하면 `.env` 파일에 `API_KEY`, `DB_URL` 등을 두고, `.gitignore`에 반드시 포함하세요.

---

## 2. CORS 설정 (백엔드 도입 시)

- API 서버를 두면 **CORS(Cross-Origin Resource Sharing)** 를 설정해야 합니다.
- **허용 도메인 화이트리스트**에 다음만 넣어 두세요.
  - `https://my-platform.pages.dev`
  - 커스텀 도메인 사용 시: `https://your-domain.com`
- `Access-Control-Allow-Origin`에 `*`를 쓰지 말고, 위 도메인만 명시하세요.

---

## 3. HTTPS

- Cloudflare Pages는 **HTTPS가 기본**입니다. 커스텀 도메인 연결 시에도 Cloudflare에서 SSL 인증서를 발급·갱신하므로, **항상 HTTPS**로만 접속되도록 설정해 두세요.

---

## 4. 인증·인가 (백엔드 API 도입 시)

- **JWT 사용 시**:
  - **AccessToken**: 짧은 만료 시간(예: 15분~1시간).
  - **RefreshToken**: HttpOnly 쿠키에 저장해 XSS로 토큰 탈취를 줄이세요.
- **운영자/관리자 기능**: 서버에서 세션·토큰을 검증한 뒤, **서버에서만** 삭제·수정을 처리하세요. 클라이언트만 믿지 마세요.

---

## 5. 데이터 유효성 검사

- **프론트**: 이메일 형식, 글자 수 제한, 필수 입력 등으로 1차 검증.
- **백엔드**: 모든 입력값을 **서버에서 다시 검증**하세요 (이메일 형식, 길이, 타입, SQL/NoSQL 인젝션 방지).

---

## 6. 로깅 (백엔드 도입 시)

- **Winston**, **Pino** 등으로 에러·요청 로그를 남기세요. 에러 발생 시 스택 트레이스는 로그에만 남기고, 사용자에게는 "잠시 후 다시 시도해 주세요" 같은 일반 메시지만 보여 주세요.

---

## 7. 데이터베이스 인덱싱

- 자주 검색·필터링하는 컬럼(예: `createdAt`, `userId`, `board`)에는 **인덱스**를 걸어 두면, 데이터가 많아질 때 성능과 안정성에 도움이 됩니다.

---

이 문서는 현재 정적 사이트 + Firebase 구조를 기준으로 작성되었습니다. 백엔드 API·DB를 도입할 때 위 항목을 단계별로 적용하면 됩니다.
